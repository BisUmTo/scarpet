__config() -> {'scope'->'global','stay_loaded'->true};

global_placeable_items = {'allium', 'azure_bluet', 'bamboo', 'blue_orchid', 'brown_mushroom', 'cornflower', 'crimson_fungus', 'crimson_roots', 'dandelion', 'dead_bush', 'fern', 'grass', 'lily_of_the_valley', 'nether_sprouts', 'orange_tulip', 'oxeye_daisy', 'pink_tulip', 'poppy', 'red_mushroom', 'red_tulip', 'sweet_berries', 'warped_fungus', 'warped_roots', 'white_tulip', 'wither_rose'};
global_placeable_tall_items = {'large_fern', 'lilac', 'peony', 'rose_bush', 'sunflower', 'tall_grass'};

global_flat_surface = {'acacia_leaves', 'acacia_log', 'acacia_planks', 'acacia_wood', 'ancient_debris', 'andesite', 'anvil', 'barrel', 'barrier', 'basalt', 'beacon', 'bedrock', 'bee_nest', 'beehive', 'birch_leaves', 'birch_log', 'birch_planks', 'birch_wood', 'black_concrete', 'black_concrete_powder', 'black_glazed_terracotta', 'black_shulker_box', 'black_stained_glass', 'black_terracotta', 'black_wool', 'blackstone', 'blast_furnace', 'blue_concrete', 'blue_concrete_powder', 'blue_glazed_terracotta', 'blue_ice', 'blue_shulker_box', 'blue_stained_glass', 'blue_terracotta', 'blue_wool', 'bone_block', 'bookshelf', 'brain_coral_block', 'bricks', 'brown_concrete', 'brown_concrete_powder', 'brown_glazed_terracotta', 'brown_mushroom_block', 'brown_shulker_box', 'brown_stained_glass', 'brown_terracotta', 'brown_wool', 'bubble_coral_block', 'cactus', 'cartography_table', 'carved_pumpkin', 'chain_command_block', 'chipped_anvil', 'chiseled_nether_bricks', 'chiseled_polished_blackstone', 'chiseled_quartz_block', 'chiseled_red_sandstone', 'chiseled_sandstone', 'chiseled_stone_bricks', 'clay', 'coal_block', 'coal_ore', 'coarse_dirt', 'cobblestone', 'command_block', 'cracked_nether_bricks', 'cracked_polished_blackstone_bricks', 'cracked_stone_bricks', 'crafting_table', 'crimson_fungus', 'crimson_hyphae', 'crimson_nylium', 'crimson_planks', 'crimson_stem', 'crying_obsidian', 'cut_red_sandstone', 'cut_sandstone', 'cyan_concrete', 'cyan_concrete_powder', 'cyan_glazed_terracotta', 'cyan_shulker_box', 'cyan_stained_glass', 'cyan_terracotta', 'cyan_wool', 'damaged_anvil', 'dark_oak_leaves', 'dark_oak_log', 'dark_oak_planks', 'dark_oak_wood', 'dark_prismarine', 'dead_brain_coral_block', 'dead_bubble_coral_block', 'dead_fire_coral_block', 'dead_horn_coral_block', 'dead_tube_coral_block', 'diamond_block', 'diamond_ore', 'diorite', 'dirt', 'dispenser', 'dried_kelp_block', 'dropper', 'emerald_block', 'emerald_ore', 'end_stone', 'end_stone_bricks', 'farmland', 'fire_coral_block', 'fletching_table', 'frosted_ice', 'furnace', 'gilded_blackstone', 'glass', 'glowstone', 'gold_block', 'gold_ore', 'granite', 'grass_block', 'grass_path', 'gravel', 'gray_concrete', 'gray_concrete_powder', 'gray_glazed_terracotta', 'gray_shulker_box', 'gray_stained_glass', 'gray_terracotta', 'gray_wool', 'green_concrete', 'green_concrete_powder', 'green_glazed_terracotta', 'green_shulker_box', 'green_stained_glass', 'green_terracotta', 'green_wool', 'hay_block', 'honey_block', 'honeycomb_block', 'hopper', 'horn_coral_block', 'ice', 'infested_chiseled_stone_bricks', 'infested_cobblestone', 'infested_cracked_stone_bricks', 'infested_mossy_stone_bricks', 'infested_stone', 'infested_stone_bricks', 'iron_block', 'iron_ore', 'jack_o_lantern', 'jigsaw', 'jukebox', 'jungle_leaves', 'jungle_log', 'jungle_planks', 'jungle_wood', 'lapis_block', 'lapis_ore', 'light_blue_concrete', 'light_blue_concrete_powder', 'light_blue_glazed_terracotta', 'light_blue_shulker_box', 'light_blue_stained_glass', 'light_blue_terracotta', 'light_blue_wool', 'light_gray_concrete', 'light_gray_concrete_powder', 'light_gray_glazed_terracotta', 'light_gray_shulker_box', 'light_gray_stained_glass', 'light_gray_terracotta', 'light_gray_wool', 'lime_concrete', 'lime_concrete_powder', 'lime_glazed_terracotta', 'lime_shulker_box', 'lime_stained_glass', 'lime_terracotta', 'lime_wool', 'lodestone', 'loom', 'magenta_concrete', 'magenta_concrete_powder', 'magenta_glazed_terracotta', 'magenta_shulker_box', 'magenta_stained_glass', 'magenta_terracotta', 'magenta_wool', 'magma_block', 'melon', 'mossy_cobblestone', 'mossy_stone_bricks', 'mycelium', 'nether_bricks', 'nether_gold_ore', 'nether_quartz_ore', 'nether_wart_block', 'netherite_block', 'netherrack', 'note_block', 'oak_leaves', 'oak_log', 'oak_planks', 'oak_wood', 'observer', 'obsidian', 'orange_concrete', 'orange_concrete_powder', 'orange_glazed_terracotta', 'orange_shulker_box', 'orange_stained_glass', 'orange_terracotta', 'orange_wool', 'packed_ice', 'pink_concrete', 'pink_concrete_powder', 'pink_glazed_terracotta', 'pink_shulker_box', 'pink_stained_glass', 'pink_terracotta', 'pink_wool', 'piston', 'podzol', 'polished_andesite', 'polished_basalt', 'polished_blackstone', 'polished_blackstone_bricks', 'polished_diorite', 'polished_granite', 'prismarine', 'prismarine_bricks', 'pumpkin', 'purple_concrete', 'purple_concrete_powder', 'purple_glazed_terracotta', 'purple_shulker_box', 'purple_stained_glass', 'purple_terracotta', 'purple_wool', 'purpur_block', 'purpur_pillar', 'quartz_block', 'quartz_bricks', 'quartz_pillar', 'red_concrete', 'red_concrete_powder', 'red_glazed_terracotta', 'red_mushroom_block', 'red_nether_bricks', 'red_sand', 'red_sandstone', 'red_shulker_box', 'red_stained_glass', 'red_terracotta', 'red_wool', 'redstone_block', 'redstone_lamp', 'redstone_ore', 'repeating_command_block', 'respawn_anchor', 'sand', 'sandstone', 'scaffolding', 'sea_lantern', 'shroomlight', 'shulker_box', 'slime_block', 'smithing_table', 'smoker', 'smooth_quartz', 'smooth_red_sandstone', 'smooth_sandstone', 'smooth_stone', 'snow_block', 'soul_sand', 'soul_soil', 'spawner', 'sponge', 'spruce_leaves', 'spruce_log', 'spruce_planks', 'spruce_wood', 'sticky_piston', 'stone', 'stone_bricks', 'stripped_acacia_log', 'stripped_acacia_wood', 'stripped_birch_log', 'stripped_birch_wood', 'stripped_crimson_hyphae', 'stripped_crimson_stem', 'stripped_dark_oak_log', 'stripped_dark_oak_wood', 'stripped_jungle_log', 'stripped_jungle_wood', 'stripped_oak_log', 'stripped_oak_wood', 'stripped_spruce_log', 'stripped_spruce_wood', 'stripped_warped_hyphae', 'stripped_warped_stem', 'structure_block', 'target', 'terracotta', 'tnt', 'tube_coral_block', 'warped_hyphae', 'warped_nylium', 'warped_planks', 'warped_stem', 'warped_wart_block', 'wet_sponge', 'white_concrete', 'white_concrete_powder', 'white_glazed_terracotta', 'white_shulker_box', 'white_stained_glass', 'white_terracotta', 'white_wool', 'yellow_concrete', 'yellow_concrete_powder', 'yellow_glazed_terracotta', 'yellow_shulker_box', 'yellow_stained_glass', 'yellow_terracotta', 'yellow_wool'};
flat_surface(block) ->
    has(global_flat_surface, str(block)) || 
    block ~ '_trapdoor$' && property(block, 'half') == 'top' && property(block, 'open') == 0 ||
    block ~ '_stair$' && property(block, 'half') == 'top' ||
    block ~ '_slab$' && (property(block, 'type') == 'top' || property(block, 'type') == 'double');

_placeable(player, item_tuple, hand, block, face) -> (
    g = player ~ 'gamemode';
    if(g == 'spectator' || !item_tuple, return());
    [item, count, nbt] = item_tuple;
    if(face != 'up' || !has(global_placeable_items, item) && !has(global_placeable_tall_items, item) || !flat_surface(block), return());
    if(g=='adventure' && !nbt:'CanPlaceOn' ~ str('"minecraft:%s"',block), return());
    b1 = pos_offset(block, face);
    if(!air(b1), return());
    without_updates(
        if(has(global_placeable_tall_items, item),
            b2 = pos_offset(b1, face);
            if(!air(b2), return());
            set(b1, item, 'half', 'lower');
            set(b2, item, 'half', 'upper');
        else,
            set(b1, item)
        )
    );
    sound(str('minecraft:block.%s.place', block_sound(block(b1))), b1, 1, 1, 'block');
    if(g == 'creative', return()); 
    inventory_set(player, if(hand=='mainhand',player~'selected_slot',-1), count - 1, item ,nbt)
);

__on_player_right_clicks_block(player, item_tuple, hand, block, face, hitvec) -> (
    _placeable(player, item_tuple, hand, block, face)
)
